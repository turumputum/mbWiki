---
title: Настройки
draft: false
tags:
---

## Доступ к файловой системе
Контент и настройки хранятся в виде файлов в энергонезависимой памяти устройства. 
Может быть использована встроенная память микроконтроллера или внешняя [[SD_card|SD карта]]. 

Доступ к файлам можно получить несколькими способами:
1. С помощью интерфейса USB. Устройство можно подключить к ПК как съемный диск.

2. Через LAN сеть. Подключиться к FTP-серверу, запущенному на устройстве.  Для этого потребуется знать IP адрес устройства или использовать MDNS имя *"{device_name}.local"*
   FTP-сервер порт 21
   логин: «user»
   пароль: «pass»
   Сервер работает в пассивном режиме и поддерживает ==ОДНО подключение единовременно==.
   Рекомендуемое ПО: Total Commander, WinSCP, FileZilla.
   
3. В случаях когда используется карта памяти, возможно физически извлечь SD-карту из устройства и использовать кард-ридер для доступа к файловой системе

Для возврата к настройкам по умолчанию, необходимо удалить файл config.ini. Конфигурационный файл с «заводскими» настройками будет создан автоматически.

В корневом каталоге файловой системы располагаются:
- config.ini — файл конфигурации;
- error.txt — файл будет создан в случае возникновения ошибок.

В именах файлов и параметров поддерживаются только латинские символы.


## Структура конфигурационного файла

Секция [SYSTEM] содержит имя устройства в параметре device_name.

В секции [LAN] находятся настройки параметров подключения к локальной сети:
- LAN_enable - включить/выключить Ethernet
- DHCP - использовать DHCP или статический IP
- ipAdress, netMask, gateWay - статический IP, маска и шлюз (если DHCP выключен)

В секции [UDP] параметры для UDP соединения:
- udpServerAdress и udpServerPort - адрес и порт сервера
- udpMyPort - локальный порт модуля для приема данных

В секции [OSC] аналогично параметры для OSC.

В секции [MQTT] содержится адрес брокера mqttBrokerAdress.

Далее идут секции конфигурации слотов [SLOT_N].
- mode - режим работы слота
- options - [[Software#Опции|Дополнительные опции работы слота]]
- cross_link - [[Software#Внутренние связи(cross_link)|Внутренние связи]]

## Опции
Дополнительные опции работы слота, указываются в графе *"options"* советующего модуля.
Могут быть флагом, например:
```ini
[SLOT_0]
;модуль в режиме кнопка с подсветкой
mode = button_led
;инвертируем кнопку
options = button_inverse 
```
Или указывать значение виде числа или строки
```ini
[SLOT_0]
;модуль в режиме кнопка с подсветкой
mode = button_led
;инвертируем кнопку
options = button_inverse 

```

## Команды и события
По умолчания все события и команды обрабатываются от всех доступных(настроенных) источников(COM порт, UDP, OSC, MQTT). Могут иметь простой вид *«топик:значение»*, стандартный топик состоит из "device_name"(настроенного в конфигурационном файле, в секции [SYSTEM]) и имени объекта, пример:
```ini
;команда, включить светодиод 0
device_name/led_0:1
;событие, нажата кнопка 0
device_name/button_0:1
```
или сложный, если программный модуль имеет подкоманды:
```ini
;команда, проиграть трек с индексом 2
device_name/player_0/play:2
;событие, плеер закончил проигрывание трека 2
device_name/player_0/play_end:2
```
Все программные модули имеют возможность настроить нестандартный (пользовательский) топик, в графе *"options"* советующего модуля. Для событий и действий топики внутри одного модуля, могут различаться, это можно уточнить в документации на модуль.
Пример:
```ini
; установка пользовательских топиков для кнопки и подсветки
options = button_topic:zone_7/pLayKey, led_topic:zone_7/playIndicator
```


## Внутренние связи(cross_link)
Модули внутри устройства могут взаимодействовать между собой. Связи описывается в формате: *"событие:значение->команда:значение"*, событие связано с модулем внутри которого описывается текущая связь. Например button_2 - кнопка в слоте 2 и связь должна быть описана в блоке слота номер 2-а. Приемником команды может быть любой слот, например led_3 - светодиод в слоте 3

Команда может иметь простой дискретный вид(включить/выключить), например *led_0:1* - включить светодиод в слоте  0.
```ini
;при нажатии кнопки 2 включить светодиод 3
cross_link = button_2:1->led_3:1
```
Так и задействовать подкоманды доступные для данного программного модуля, например:
```ini
;при нажатии кнопки 3 установить указатель на трек с индексом 3
cross_link = button_3:1->player_0/shift:3
```

Таким образом, используя cross_link можно настроить сложные взаимосвязи между разными слотами модуля ModuleBox для решения конкретных задач.

При использовании стандартных  топиков, имя устройства автоматически удаляется, но при использовании не стандартных топиков он используется целиком. Например:
```ini
[SLOT_0]
;модуль в режиме кнопка с подсветкой
mode = button_led
;настраиваем пользовательский топик
options = button_topic:zone_7/keyOne 
;реагируем на нажатие кнопки включением\выключение светодиода
cross_link = zone_7/keyOne:1->led_0:1, zone_7/keyOne:0->led_0:0
```


## Специальные символы
- **#** - вызов команды с текущим значением, без изменений или реакция на событие с любым значением. Например может быть использован для запуска проигрывателя при снятии наушника, когда выбор проигрываемого трека определяется кнопками. 
 ```ini
 ;команда, проиграть трек на который указывает указатель в текущий момент
 device_name/player_0/play:#
 ;по завершению любого трека проиграть следующий
 cross_link = player_0/endOfTrack:#->player_0/play:+1
```


